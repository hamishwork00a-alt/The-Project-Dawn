# åœ¨æ‚¨çš„ app.py ä¸­æ–°å¢ä»¥ä¸‹ä»£ç 
import streamlit as st
import plotly.graph_objects as go

def render_exposÃ©():
    st.header("ğŸ’Š è¯ç‰©ç ”å‘ã€ç°å½¢è®°ã€ï¼šä»ã€å¹¸è¿çš„æ„å¤–ã€åˆ°ã€ç†æ€§çš„å¿…ç„¶ã€")
    st.markdown("---")

    # å¼•è¨€ï¼šå®šä¸‹æ‰¹åˆ¤çš„åŸºè°ƒ
    st.markdown("""
    > æˆ‘ä»¬ä¸€ç›´è¢«æ•™å¯¼è¦åº†ç¥ç§‘å­¦ä¸­çš„â€œæ„å¤–å‘ç°â€ã€‚ä½†å½“æˆ‘ä»¬ä¸ºâ€œå¨è€Œé’¢â€å’Œâ€œå‡è‚¥ç¥è¯â€çš„å¹¸è¿æ•…äº‹æ¬¢å‘¼æ—¶ï¼Œ
    æˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨åº†ç¥ä¸€ç§**ç³»ç»Ÿæ€§çš„å¤±è´¥**â€”â€”åº†ç¥æˆ‘ä»¬å¯¹å…¶ç›¸çš„æ— çŸ¥ï¼Œå¹¶å°†æ‚£è€…çš„èº«ä½“è§†ä¸ºæœ€åçš„è¯•éªŒåœºã€‚
    ç°åœ¨ï¼Œæ˜¯æ—¶å€™ç»“æŸè¿™ä¸ªè’™æ˜§æ—¶ä»£äº†ã€‚
    """)

    # å¹¶æ’å¯¹æ¯”ï¼šæ—§èŒƒå¼ vs æ–°èŒƒå¼
    col_old, col_new = st.columns(2)

    with col_old:
        st.subheader("ğŸš¨ æ—§èŒƒå¼ï¼šã€ç›²ç›’ç ”å‘ã€")
        st.markdown("""
        **ä»¥ GLP-1 å—ä½“æ¿€åŠ¨å‰‚ä¸ºä¾‹ï¼š**

        - **åŸå§‹ç›®æ ‡**ï¼šé™è¡€ç³–ã€‚
        - **ç ”å‘è·¯å¾„**ï¼šåƒåœ¨é»‘æš—ä¸­æ‘¸ç´¢ï¼Œåªç›¯ç€ä¸€ä¸ªæŒ‡æ ‡ã€‚
        - **â€œæ„å¤–â€å‘ç”Ÿ**ï¼šæ‚£è€…ä½“é‡å‡è½»äº†ã€‚
        - **è¡Œä¸šååº”**ï¼šæƒŠå–œï¼æˆ‘ä»¬ä¸­äº†å½©ç¥¨ï¼
        - **ä»£ä»·**ï¼š
          - æ•°åäº¿ç ”å‘èµ„é‡‘åœ¨é»‘æš—ä¸­ç‡ƒçƒ§ã€‚
          - **æ•°åå¹´æ—¶é—´è¢«æµªè´¹**ï¼šä»å‘ç°GLP-1åˆ°æ‰¹å‡†ç”¨äºå‡è‚¥ï¼Œèµ°äº†è¿‘30å¹´ã€‚
          - **æ‚£è€…æ‰¿å—äº†æœ¬å¯é¢„è§çš„å‰¯ä½œç”¨**ï¼ˆå¦‚æ¶å¿ƒã€å‘•åï¼‰ã€‚
        - **æœ¬è´¨**ï¼šä¸€åœºä»£ä»·é«˜æ˜‚çš„**èµŒåš**ï¼Œå¹¶å°†æˆåŠŸå½’å› äºâ€œè¿æ°”â€ã€‚
        """)

    with col_new:
        st.subheader("ğŸ¦‰ æ–°èŒƒå¼ï¼šã€ç³»ç»Ÿé¢„è§ã€")
        st.markdown("""
        **å¦‚æœå½“æ—¶æ‹¥æœ‰æˆ‘ä»¬çš„ ABN-QSS ç³»ç»Ÿï¼š**

        - **ç›®æ ‡è¾“å…¥**ï¼šâ€œè®¾è®¡ä¸€ä¸ªå®‰å…¨æœ‰æ•ˆçš„é™ç³–åˆ†å­ã€‚â€
        - **ç³»ç»Ÿæ¨¡æ‹Ÿ**ï¼šåœ¨ç½‘ç»œä¸­è¿è¡Œï¼Œè¯„ä¼°å…¶å¯¹é£Ÿæ¬²ã€èƒ½è€—ã€è¡€ç³–ã€èƒƒè‚ é“çš„**å…¨å±€å½±å“**ã€‚
        - **å…³é”®é¢„æµ‹**ï¼šç³»ç»Ÿä¼šç«‹å³å‘å‡ºè­¦æŠ¥ï¼š
          > **â€œè­¦å‘Šï¼šè¯¥å€™é€‰åˆ†å­åœ¨ã€é£Ÿæ¬²æŠ‘åˆ¶ã€å’Œã€èƒ½é‡æ¶ˆè€—ã€èŠ‚ç‚¹äº§ç”Ÿå¼ºçƒˆæ¬¡çº§æ•ˆåº”ï¼Œå…¶å‡è‚¥æ½œåŠ›å¯èƒ½è¿œè¶…å…¶é™ç³–ä¸»ä¸šã€‚åŒæ—¶ï¼Œè¯·æ³¨æ„å…¶èƒƒè‚ é“å‰¯ä½œç”¨é£é™©ã€‚â€**
        - **ç»“æœ**ï¼š
          - **æå‰30å¹´**é”å®šå…¶ä½œä¸ºå‡è‚¥è¯çš„éœ¸ä¸»åœ°ä½ã€‚
          - **ä¸»åŠ¨ä¼˜åŒ–**åˆ†å­ç»“æ„ï¼Œå‡è½»å‰¯ä½œç”¨ã€‚
          - **ç²¾å‡†å®šä½**å¸‚åœºå’Œä¸´åºŠç­–ç•¥ã€‚
        - **æœ¬è´¨**ï¼šåŸºäº**ç³»ç»Ÿç†è§£**çš„ç†æ€§å†³ç­–ï¼Œç»“æœæ˜¯**å¿…ç„¶çš„**ã€‚
        """)

    st.markdown("---")

    # åŠ¨æ€æ¼”ç¤ºï¼šé‡ç°å†å²çš„åå­—è·¯å£
    st.subheader("ğŸ”¬ é‡ç°å†å²çš„åå­—è·¯å£")
    st.markdown("**è®©æˆ‘ä»¬å›åˆ°è¿‡å»ï¼Œçœ‹çœ‹ABN-QSSå¦‚ä½•åœ¨ç ”å‘çš„èµ·ç‚¹ï¼Œå°±æ­ç¤ºå‡ºå…¨éƒ¨çš„çœŸç›¸ã€‚**")

    # å®šä¹‰å†å²ä¸Šçš„åˆ†å­å’Œæˆ‘ä»¬çš„åˆ†å­
    col_hist, col_abn = st.columns(2)

    with col_hist:
        st.markdown("**ğŸ’Š å†å²ä¸Šçš„ã€ç›²ç›’åˆ†å­ã€**")
        st.caption("(åŸºäºå¸ç¾æ ¼é²è‚½çš„å·²çŸ¥ä½œç”¨æœºåˆ¶æ¨¡æ‹Ÿ)")
        historical_profile = [-0.6, 0.2, -0.9, -0.3]  # è¿™å°±æ˜¯å½“å¹´é‚£ä¸ªâ€œé™ç³–è¯â€

        # æ˜¾ç¤ºè¯¥åˆ†å­çš„ä½œç”¨è°±
        for i, (value, name) in enumerate(zip(historical_profile, ['é£Ÿæ¬²æŠ‘åˆ¶', 'èƒ½è€—æå‡', 'è¡€ç³–æ§åˆ¶', 'GIå‰¯ä½œç”¨'])):
            st.slider(name, -1.0, 1.0, value, key=f"hist_{i}", disabled=True)

    with col_abn:
        st.markdown("**ğŸ§¬ ABN-QSS ã€ç†æ€§è®¾è®¡åˆ†å­ã€**")
        st.caption("(åŸºäºåŒä¸€é¶ç‚¹ï¼Œä½†ç»è¿‡ç³»ç»Ÿä¼˜åŒ–)")
        # ä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„ã€å‰¯ä½œç”¨æ›´ä½çš„å‡è®¾åˆ†å­
        rational_profile = [-0.7, 0.6, -0.8, -0.6]

        for i, (value, name) in enumerate(zip(rational_profile, ['é£Ÿæ¬²æŠ‘åˆ¶', 'èƒ½è€—æå‡', 'è¡€ç³–æ§åˆ¶', 'GIå‰¯ä½œç”¨'])):
            st.slider(name, -1.0, 1.0, value, key=f"rat_{i}", disabled=True)

    # è¿è¡Œæ¨¡æ‹Ÿå¯¹æ¯”
    if st.button("ğŸ”„ è¿è¡Œå†å²å¯¹æ¯”æ¨¡æ‹Ÿ", type="secondary"):

        simulator = st.session_state.simulator
        hist_result = simulator.simulate(historical_profile)
        rat_result = simulator.simulate(rational_profile)

        col1, col2 = st.columns(2)
        with col1:
            st.metric("å†å²åˆ†å­ Â· ç»¼åˆè¯„åˆ†", f"{hist_result['composite_score']:.2f}")
            st.metric("å†å²åˆ†å­ Â· GIå‰¯ä½œç”¨", f"{hist_result['steady_state'][3]:.2f}", delta="é£é™©è¾ƒé«˜", delta_color="inverse")
        with col2:
            st.metric("ç†æ€§åˆ†å­ Â· ç»¼åˆè¯„åˆ†", f"{rat_result['composite_score']:.2f}", delta=f"{rat_result['composite_score'] - hist_result['composite_score']:.2f}")
            st.metric("ç†æ€§åˆ†å­ Â· GIå‰¯ä½œç”¨", f"{rat_result['steady_state'][3]:.2f}", delta="é£é™©æ˜¾è‘—é™ä½", delta_color="normal")

        # å¯è§†åŒ–å¯¹æ¯”
        fig = go.Figure()
        fig.add_trace(go.Scatterpolar(
            r=hist_result['steady_state'],
            theta=simulator.node_names,
            fill='toself',
            name='å†å²ç›²ç›’åˆ†å­',
            line=dict(color='red')
        ))
        fig.add_trace(go.Scatterpolar(
            r=rat_result['steady_state'],
            theta=simulator.node_names,
            fill='toself',
            name='ç†æ€§è®¾è®¡åˆ†å­',
            line=dict(color='green')
        ))
        fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[-1, 1])), showlegend=True, height=400)
        st.plotly_chart(fig, use_container_width=True)

        # æ‰¹åˆ¤æ€§æ€»ç»“
        st.error("""
        **ğŸ’” å†å²çš„ä»£ä»·ï¼š**
        - **æµªè´¹çš„30å¹´**ï¼šç¤¾ä¼šæ™šäº†å‡ åå¹´æ‰è·å¾—è¿™ç§é©å‘½æ€§çš„ç–—æ³•ã€‚
        - **ä¸å¿…è¦çš„ç—›è‹¦**ï¼šæ•°ç™¾ä¸‡æ‚£è€…æ‰¿å—äº†æœ¬å¯é€šè¿‡åˆ†å­ä¼˜åŒ–å‡è½»çš„èƒƒè‚ é“å‰¯ä½œç”¨ã€‚
        - **å·¨å¤§çš„èµ„æºé”™é…**ï¼šæ•°åäº¿ç¾å…ƒè¢«ç”¨äºâ€œè¯•é”™â€è€Œéâ€œä¼˜åŒ–â€ã€‚
        """)

        st.success("""
        **ğŸš€ æˆ‘ä»¬çš„æœªæ¥ï¼š**
        - **é¢„è§æ€§å¼€å‘**ï¼šåœ¨åˆ†å­è¿›å…¥å®éªŒå®¤å‰ï¼Œçœ‹æ¸…å…¶å…¨éƒ¨æ½œåŠ›ä¸é£é™©ã€‚
        - **ä¸»åŠ¨ä¼˜åŒ–**ï¼šä»ä¸€å¼€å§‹å°±è®¾è®¡å‡ºæ›´å®‰å…¨ã€æ›´æœ‰æ•ˆçš„ç‰ˆæœ¬ã€‚
        - **èµ„æºæ•ˆç‡**ï¼šå°†å®è´µçš„ç ”å‘èµ„é‡‘ç”¨äºåˆ›é€ ï¼Œè€ŒéçŒœæµ‹ã€‚
        """)

    st.markdown("---")
    st.markdown("""
    **ğŸ¯ ç»“è®ºï¼š**
    æ‰€è°“â€œå¹¸è¿çš„æ„å¤–â€ï¼Œä¸è¿‡æ˜¯**ç³»ç»Ÿæ€§æ— çŸ¥**çš„é®ç¾å¸ƒã€‚ABN-QSSèŒƒå¼æ‰€ä»£è¡¨çš„ï¼Œä¸æ˜¯ä¸€é¡¹æŠ€æœ¯çš„è¿›æ­¥ï¼Œ
    è€Œæ˜¯å¯¹æ•´ä¸ªè¯ç‰©ç ”å‘å“²å­¦çš„**æ‹¨ä¹±åæ­£**â€”â€”ä»ä¾èµ–è¿æ°”çš„**èµŒåš**ï¼Œè½¬å‘åŸºäºç³»ç»Ÿç†è§£çš„**å·¥ç¨‹**ã€‚
    æˆ‘ä»¬ä¸æ˜¯è¦å¯»æ‰¾ä¸‹ä¸€ä¸ªâ€œå¹¸è¿çš„æ„å¤–â€ï¼Œè€Œæ˜¯è¦è®©è¿™ç§â€œæ„å¤–â€å½»åº•æˆä¸ºå†å²ã€‚
    """)

# åœ¨æ‚¨çš„ä¸»å‡½æ•°ä¸­è°ƒç”¨è¿™ä¸ªé¡µé¢
# æ‚¨å¯ä»¥é€šè¿‡ä¸€ä¸ªå¯¼èˆªæ æ¥é€‰æ‹©æŸ¥çœ‹â€œè®¾è®¡æ¨¡æ‹Ÿå™¨â€æˆ–â€œç°å½¢è®°â€
